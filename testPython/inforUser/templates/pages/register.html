<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <form class="row g-3 needs-validation" method="POST" novalidate>
      {% csrf_token %}
      <div class="col-md-12">
        <label for="validationCustomUsername" class="form-label"
          >Email sinh viên</label
        >
        <div class="input-group has-validation">
          <span class="input-group-text" id="inputGroupPrepend">@</span>
          <input
            value=""
            name="email"
            type="text"
            class="form-control"
            id="validationCustomUsername"
            aria-describedby="inputGroupPrepend"
            required
          />
          <div class="invalid-feedback">Điền email đầy đủ</div>
        </div>
      </div>
      <div class="col-md-12">
        <div class="col-md-12">
          <label for="validationCustom01" class="form-label"
            >Tên đăng nhập</label
          >
          <input
            name="username"
            type="text"
            class="form-control"
            id="validationCustom01"
            value=""
            required
          />
          <div class="valid-feedback">Looks good!</div>
        </div>
        <div class="col-md-12">
          <label for="validationCustom02" class="form-label">Mật khẩu</label>
          <input
            type="password"
            name="password"
            class="form-control"
            id="validationCustom02"
            value=""
            required
          />
          <div class="valid-feedback">Looks good!</div>
        </div>

        <label for="validationCustom03" class="form-label">Mã sinh viên</label>
        <input
          type="text"
          name="student_id"
          class="form-control"
          id="validationCustom03"
          required
        />
        <div class="invalid-feedback">Cung cấp mã sinh viên</div>
      </div>

      <div class="col-12">
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            value=""
            id="invalidCheck"
            required
          />
          <label class="form-check-label" for="invalidCheck">
            Đồng ý điều khoản của PTIT
          </label>
          <div class="invalid-feedback">
            Bạn phải chấp nhận điều khoản của PTIT
          </div>
        </div>
      </div>
      <div class="col-12">
        <button class="btn btn-primary" type="submit">Submit form</button>
      </div>
    </form>
  </body>
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }
    body {
      padding: 100px;
    }
    form {
      padding: 50px;
      box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px,
        rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    }
  </style>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"
  ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script>
    function encryptPassword() {
      const passwordField = document.querySelector('input[name="password"]');
      const student_idField = document.querySelector(
        'input[name="student_id"]'
      );
      const password = passwordField.value;
      const student_id = student_idField.value;
      const key = CryptoJS.enc.Utf8.parse("secretkey1234567"); // key để mã hóa mật khẩu, có thể thay đổi
      const iv = CryptoJS.enc.Utf8.parse("1234567890123456"); // initialization vector, có thể thay đổi

      // Mã hóa mật khẩu sử dụng thuật toán AES với key và iv đã cho
      const encryptedPassword = CryptoJS.AES.encrypt(password, key, {
        iv: iv,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7,
      });
      // Mã hóa student_id sử dụng thuật toán AES với key và iv đã cho
      const encryptedStudenId = CryptoJS.AES.encrypt(student_id, key, {
        iv: iv,
        mode: CryptoJS.mode.CBC,
        padding: CryptoJS.pad.Pkcs7,
      });

      // Gán mật khẩu đã mã hóa vào trường input
      passwordField.value = encryptedPassword.toString();
      // Gán student_id đã mã hóa vào trường input
      student_idField.value = encryptedStudenId.toString();
    }
  </script>

  <script>
    (function () {
      "use strict";

      var forms = document.querySelectorAll(".needs-validation");

      Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener(
          "submit",
          function (event) {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            } else {
              // Mã hóa mật khẩu trước khi submit
              encryptPassword();
            }

            form.classList.add("was-validated");
          },
          false
        );
      });
    })();
  </script>
</html>
